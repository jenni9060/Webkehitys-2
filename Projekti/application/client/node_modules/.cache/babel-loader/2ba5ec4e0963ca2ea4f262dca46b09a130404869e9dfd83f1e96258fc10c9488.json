{"ast":null,"code":"var _jsxFileName = \"C:\\\\Visual studio projects\\\\webkehitys-2\\\\Projekti\\\\application\\\\client\\\\src\\\\components\\\\Search.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Search({\n  searchCity,\n  setSearchCity,\n  onSearch,\n  user\n}) {\n  _s();\n  const [searchHistory, setSearchHistory] = useState([]); // Tila hakuhistorialle\n  const [showHistory, setShowHistory] = useState(false); // Tila dropdownille\n  const historyRef = useRef(null); // Viittaus hakuhistoriaan\n\n  const handleFetchHistory = async () => {\n    try {\n      const token = sessionStorage.getItem('token'); // Hae käyttäjän token\n      const response = await fetch('http://localhost:5000/searchhistory', {\n        method: 'GET',\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const data = await response.json();\n      if (response.ok) {\n        // Suodata uniikit paikkakunnat\n        const uniqueCities = [...new Set(data.map(item => item.searched_city))];\n        setSearchHistory(uniqueCities); // Tallenna vain uniikit kaupungit tilaan\n        setShowHistory(true); // Näytä hakuhistoria\n      } else {\n        console.error('Virhe hakuhistorian haussa:', data.error);\n      }\n    } catch (err) {\n      console.error('Virhe hakuhistorian haussa:', err);\n    }\n  };\n  const handleHistorySelection = selectedCity => {\n    setShowHistory(false); // Sulje alasvetovalikko\n    setSearchCity(selectedCity); // Aseta valittu kaupunki hakukenttään\n    onSearch(selectedCity); // Käynnistä haku valitulle kaupungille\n  };\n  const handleClickOutside = event => {\n    // Tarkista ensin, että hakuhistoria on näkyvissä\n    if (showHistory) {\n      // Tarkista, onko viittaus olemassa ja sisältää klikkauskohteen\n      if (historyRef.current && !historyRef.current.contains(event.target)) {\n        setShowHistory(false); // Sulje dropdown\n      }\n    }\n  };\n  useEffect(() => {\n    if (showHistory) {\n      // Lisää kuuntelija klikkaukselle\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      // Poista kuuntelija, jos dropdown ei ole näkyvissä\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside); // Siivoa tapahtumat\n    };\n  }, [showHistory]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"section\", {\n      id: \"welcome-text\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Tervetuloa AurinkoArska.fi-sivustolle!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Sy\\xF6t\\xE4 kaupungin nimi n\\xE4hd\\xE4ksesi ajankohtaiset s\\xE4\\xE4tiedot.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      id: \"search-input-section\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"city\",\n        placeholder: \"Sy\\xF6t\\xE4 kaupunki\",\n        value: searchCity,\n        onChange: e => setSearchCity(e.target.value) // Päivitä hakukentän tila\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      id: \"search-button-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"weather-button-container\",\n        children: [user && /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"history-button\",\n          onClick: handleFetchHistory,\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: `/file.png`,\n            alt: \"Hakuhistoria Ikoni\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 25\n          }, this), \"Hakuhistoria\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"search_weather\",\n          className: \"weather_button\",\n          onClick: () => onSearch(searchCity),\n          children: \"Hae s\\xE4\\xE4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 13\n      }, this), showHistory && /*#__PURE__*/_jsxDEV(\"ul\", {\n        id: \"history-dropdown\",\n        ref: historyRef,\n        children: searchHistory.length > 0 ? searchHistory.map((item, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          onClick: () => handleHistorySelection(item),\n          children: item\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 33\n        }, this)) : /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Ei hakuhistoriaa\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n_s(Search, \"mEKB9r1BwKPqQ7aw1L8bi51Qz10=\");\n_c = Search;\nexport default Search;\nvar _c;\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"names":["React","useState","useEffect","useRef","jsxDEV","_jsxDEV","Fragment","_Fragment","Search","searchCity","setSearchCity","onSearch","user","_s","searchHistory","setSearchHistory","showHistory","setShowHistory","historyRef","handleFetchHistory","token","sessionStorage","getItem","response","fetch","method","headers","Authorization","data","json","ok","uniqueCities","Set","map","item","searched_city","console","error","err","handleHistorySelection","selectedCity","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","children","id","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","value","onChange","e","onClick","src","alt","className","ref","length","index","_c","$RefreshReg$"],"sources":["C:/Visual studio projects/webkehitys-2/Projekti/application/client/src/components/Search.jsx"],"sourcesContent":["\r\nimport React, { useState, useEffect, useRef } from 'react';\r\n\r\nfunction Search({ searchCity, setSearchCity, onSearch, user }) {\r\n    const [searchHistory, setSearchHistory] = useState([]); // Tila hakuhistorialle\r\n    const [showHistory, setShowHistory] = useState(false); // Tila dropdownille\r\n    const historyRef = useRef(null); // Viittaus hakuhistoriaan\r\n\r\n    const handleFetchHistory = async () => {\r\n   \r\n        try {\r\n            const token = sessionStorage.getItem('token'); // Hae käyttäjän token\r\n            const response = await fetch('http://localhost:5000/searchhistory', {\r\n                method: 'GET',\r\n                headers: {\r\n                    Authorization: `Bearer ${token}`,\r\n                },\r\n            });\r\n            const data = await response.json();\r\n            if (response.ok) {\r\n                // Suodata uniikit paikkakunnat\r\n                const uniqueCities = [...new Set(data.map(item => item.searched_city))];\r\n                setSearchHistory(uniqueCities); // Tallenna vain uniikit kaupungit tilaan\r\n                setShowHistory(true); // Näytä hakuhistoria\r\n            } else {\r\n                console.error('Virhe hakuhistorian haussa:', data.error);\r\n            }\r\n        } catch (err) {\r\n            console.error('Virhe hakuhistorian haussa:', err);\r\n        }\r\n    };\r\n\r\n    const handleHistorySelection = (selectedCity) => {\r\n        setShowHistory(false); // Sulje alasvetovalikko\r\n        setSearchCity(selectedCity); // Aseta valittu kaupunki hakukenttään\r\n        onSearch(selectedCity); // Käynnistä haku valitulle kaupungille\r\n    };\r\n\r\n    const handleClickOutside = (event) => {\r\n        // Tarkista ensin, että hakuhistoria on näkyvissä\r\n        if (showHistory) {\r\n            // Tarkista, onko viittaus olemassa ja sisältää klikkauskohteen\r\n            if (historyRef.current && !historyRef.current.contains(event.target)) {\r\n                setShowHistory(false); // Sulje dropdown\r\n            }\r\n        }\r\n    };\r\n    \r\n\r\n    useEffect(() => {\r\n        if (showHistory) {\r\n            // Lisää kuuntelija klikkaukselle\r\n            document.addEventListener('mousedown', handleClickOutside);\r\n        } else {\r\n            // Poista kuuntelija, jos dropdown ei ole näkyvissä\r\n            document.removeEventListener('mousedown', handleClickOutside);\r\n        }\r\n        return () => {\r\n            document.removeEventListener('mousedown', handleClickOutside); // Siivoa tapahtumat\r\n        };\r\n    }, [showHistory]);\r\n    \r\n\r\n    return (\r\n        <>\r\n        <section id=\"welcome-text\">\r\n            <p>Tervetuloa AurinkoArska.fi-sivustolle!</p>\r\n            <p>Syötä kaupungin nimi nähdäksesi ajankohtaiset säätiedot.</p>\r\n        </section>\r\n        <section id=\"search-input-section\">\r\n            <input type=\"text\" id=\"city\" placeholder=\"Syötä kaupunki\" value={searchCity}\r\n            onChange={(e) => setSearchCity(e.target.value)} // Päivitä hakukentän tila\r\n        ></input>\r\n        </section>\r\n        <section id=\"search-button-section\">\r\n            <div id=\"weather-button-container\">\r\n                {user && (\r\n                    <button id=\"history-button\" onClick={handleFetchHistory}>\r\n                        <img src={`/file.png`} alt=\"Hakuhistoria Ikoni\" />\r\n                        Hakuhistoria\r\n                    </button>\r\n                )}\r\n                <button id=\"search_weather\" className=\"weather_button\" onClick={() => onSearch(searchCity)}>Hae sää</button>\r\n            </div>\r\n                {showHistory && (\r\n                    <ul id=\"history-dropdown\" ref={historyRef}>\r\n                        {searchHistory.length > 0 ? (\r\n                            searchHistory.map((item, index) => (\r\n                                <li key={index} onClick={() => handleHistorySelection(item)}>\r\n                                    {item}\r\n                                </li>\r\n                            ))\r\n                        ) : (\r\n                            <li>Ei hakuhistoriaa</li>\r\n                        )}\r\n                    </ul>\r\n                )}\r\n        </section>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Search;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}